<ion-header>
  <ion-toolbar>
    <ion-title>Meine Service Manager Zuweisungen</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="close()">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  @if (loading()) {
    <div class="loading-container">
      <ion-spinner></ion-spinner>
      <p>Lade Service Manager...</p>
    </div>
  } @else {
    <ion-list>
      <ion-item lines="none" class="header-item">
        <ion-label>
          <h2>Service Manager</h2>
          <p>Wählen Sie die Service Manager aus, für die Sie zuständig sind</p>
        </ion-label>
      </ion-item>

      @if (serviceManagers().length === 0) {
        <ion-item>
          <ion-label class="ion-text-center">
            <p>Keine Service Manager gefunden</p>
          </ion-label>
        </ion-item>
      }

      @for (manager of serviceManagers(); track manager.id) {
        <ion-item>
          <ion-checkbox
            slot="start"
            [checked]="isAssigned(manager.id)"
            (ionChange)="toggleAssignment(manager, $event)"
          ></ion-checkbox>
          
          <ion-label>
            <h3>{{ manager.name }}</h3>
            <p>{{ manager.username }}</p>
            @if (manager.department) {
              <p>
                <ion-icon name="business"></ion-icon>
                {{ manager.department.name }}
              </p>
            }
          </ion-label>

          @if (getAssignment(manager.id); as assignment) {
            <ion-note slot="end">
              <small>Aktiv</small>
            </ion-note>
          }
        </ion-item>
      }
    </ion-list>

    <div class="summary">
      <ion-note>
        <strong>{{ myAssignments().length }}</strong> Service Manager zugewiesen
      </ion-note>
    </div>
  }
</ion-content>
